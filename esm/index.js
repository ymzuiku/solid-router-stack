import{template as rt}from"solid-js/web";import{className as it}from"solid-js/web";import{setAttribute as ct}from"solid-js/web";import{effect as lt}from"solid-js/web";import{insert as pt}from"solid-js/web";import{mergeProps as ft}from"solid-js/web";import{createComponent as H}from"solid-js/web";import{createRoot as ht,createSignal as L,For as dt,lazy as mt}from"solid-js";import{createStore as kt}from"solid-js/store";var A=[],M=t=>{A.push(t)},g=[],X=t=>{g.push(t)};["popstate","pushState","replaceState","backState"].forEach(t=>{window.addEventListener(t,()=>{t==="popstate"&&e.stack.pop();let n=e.stack[e.stack.length-1];A.forEach(s=>{s(n?n.path:"",t,e.stack)})})});var d=t=>({url:t,path:t.split("?")[0],params:D(t)||{},time:Date.now(),index:e.stack.length}),Y=t=>{g.forEach(n=>{t=n(t)}),e.stack.forEach(n=>{n.tempData=void 0}),e.stack.push(d(t)),e.useHash&&(t="/#"+t),history.pushState(null,"",t),window.dispatchEvent(new Event("pushState"))},G=t=>{g.forEach(n=>{t=n(t)}),e.stack.forEach(n=>{n.tempData=void 0}),e.stack.push(d(t)),e.useHash&&(t="/#"+t),history.replaceState(null,"",t),window.dispatchEvent(new Event("replaceState"))},B=(t,n)=>{if(g.forEach(s=>{t=s(t)}),e.stack.forEach(s=>{s.tempData=void 0}),e.stack.length>0&&e.stack.pop(),e.stack.push(d(t)),e.useHash&&(t="/#"+t),n){let s=e.stack[e.stack.length-1];s.tempData=n}history.replaceState(null,"",t),window.dispatchEvent(new Event("replaceState"))},C=t=>{let n=e.stack.length;n>1&&e.stack.pop();let s=e.stack[e.stack.length-1];if(n===1){let p=s.time,f=s.url;s=d(e.onLastBack(s)),f===s.url&&(s.time=p),e.stack[e.stack.length-1]=s}let i=s.url;return e.useHash&&(i="/#"+s.url),t&&(e.stack[e.stack.length-1].tempData=t),i},J=t=>{let n=C(t);history.replaceState(null,"",n),window.dispatchEvent(new Event("backState"))},K=t=>{let n=C(t);history.replaceState(null,"",n),window.dispatchEvent(new Event("replaceState"))},Q=t=>{e.stack=[d(t)],B(t)};function V(){let[t,n]=location.href.split("#");return new URLSearchParams([t.split("?")[1],n.split("?")[1]].join("&"))}function Z(){if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1].split("?")[0]}function tt(){if(!location.hash)return"/";let t=location.hash.split("#");return t.length<2?"/":t[1]}function D(t){let[n,s]=t.split("#"),i=new URLSearchParams([n.split("?")[1],s.split("?")[1]].join("&")),p={};for(let[f,m]of i.entries())p[f]=m;return p}var e={search:V,nowUrl:Z,nowFullUrl:tt,push:Y,pushNotHistory:G,replace:B,goBack:J,gobackNotHistory:K,clearTo:Q,listen:M,beforeChange:X,searchUrlToObject:D,onLastBack:t=>t.url,newStack:d,stack:[],useHash:!1};var w;function S(){if(w!==void 0)return w;let t=navigator.userAgent.toLocaleLowerCase();return w=new RegExp("(iphone|ipod|ipad)").test(t)&&new RegExp("(micromessenger)").test(t),w}import{template as et}from"solid-js/web";var st=et("<div>Not found page</div>",2),r={prefix:"#",classBefore:"",classNow:"",classAfter:"",navigationDuration:0,notFound:{async:!0,render:()=>st.cloneNode(!0)}};var ot=`
.solid-router-stack-now-up {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
}
.solid-router-stack-before-up {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
  opacity: 0;
  transform: translateY(10vh);
}
.solid-router-stack-after-up {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
  transform: translateY(-5vh);
}
.solid-router-stack-now-left {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
}
.solid-router-stack-before-left {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
  opacity: 0;
  transform: translateX(10vh);
}
.solid-router-stack-after-left {
  will-change: transform, opacity;
  transition: transform 200ms ease-out, opacity 300ms ease-out;
  transform: translateX(-5vh);
}
`,nt=()=>{if(typeof window<"u"&&!document.getElementById("solid-router-stack-css")){let t=document.createElement("style");t.id="solid-router-stack-css",t.innerHTML=ot,document.head.append(t)}},at=t=>{Object.assign(r,{classBefore:t==="moveUp"?"solid-router-stack-before-up":"solid-router-stack-before-left",classNow:t==="moveUp"?"solid-router-stack-now-up":"solid-router-stack-now-left",classAfter:t==="moveUp"?"solid-router-stack-after-up":"solid-router-stack-after-left",navigationDuration:200}),nt()};var ut=rt("<div></div>",2);function v(t,n){return n?r.prefix+t+"?"+new URLSearchParams(n).toString():r.prefix+t}var Ht=t=>{let n={...t},[s,i]=ht(()=>kt({list:e.stack})),p=o=>{i("list",s.list.length-1,{className:o})},f=o=>{s.list.length>1&&i("list",s.list.length-2,{className:o})},m=0,h=!1;e.listen(()=>{let o=e.stack.length,a=e.stack[e.stack.length-1];r.navigationDuration>0?o>m?(i("list",[...e.stack]),i("list",s.list.length-1,{stackTop:!0}),s.list.length>1&&i("list",s.list.length-2,{stackTop:!1}),h?(p(r.classNow),f(r.classAfter)):(p(r.classBefore),requestAnimationFrame(()=>{p(r.classNow),f(r.classAfter)}))):m!==o?(i("list",s.list.length-2,{stackTop:!0}),s.list.length>2&&i("list",s.list.length-3,{stackTop:!1}),p(r.classBefore),f(r.classNow),h?i("list",[...e.stack]):setTimeout(()=>{i("list",[...e.stack])},r.navigationDuration)):(p(r.classNow),f(r.classAfter),i("list",[...e.stack]),i("list",s.list.length-1,{stackTop:!0}),s.list.length>1&&i("list",s.list.length-2,{stackTop:!1})):(i("list",[...e.stack]),i("list",s.list.length-1,{stackTop:!0}),s.list.length>1&&i("list",s.list.length-2,{stackTop:!1})),m=o,a.tempData&&i("list",e.stack.length-1,{params:{...a.params},tempData:{...a.tempData}}),h&&requestAnimationFrame(()=>{h=!1})});let O=o=>{S()?e.gobackNotHistory(o):e.goBack(o)},E=o=>{o.async?o.Component=o.render:o.Component=mt(o.render),o.push=a=>{S()?e.pushNotHistory(v(o.path,a)):e.push(v(o.path,a))},o.replace=a=>{e.replace(v(o.path,a))},o.clearTo=a=>{e.clearTo(v(o.path,a))}};E(r.notFound),Object.keys(n).forEach(o=>{let a=n[o];E(a)});let y={},b=[];Object.keys(n).map(o=>{let a=n[o];a&&(y[r.prefix+a.path]=a,a.async||b.push(a))});function F(o){o.preloadAll?b.forEach(a=>{a.render()}):o.preload&&setTimeout(()=>{o.preload().forEach(k=>{k.async||k.render()})},200)}let j=({root:o})=>{let a=e.nowUrl(),k=e.searchUrlToObject(r.prefix+e.nowFullUrl());if(h=!0,o.push(),a!=="/"&&a!==o.path){let u=y[r.prefix+a]||r.notFound;h=!0,u.push({...k,stackAnime:"noPush"})}let[W,I]=L(typeof window<"u"?window.innerWidth:0),[z,q]=L(typeof window<"u"?window.innerHeight:0);return typeof window<"u"&&window.addEventListener("resize",()=>{I(window.innerWidth),q(window.innerHeight)}),H(dt,{get each(){return s.list},children:(u,x)=>{let _=y[u.path]||r.notFound;return F(_),(()=>{let l=ut.cloneNode(!0);return l.style.setProperty("position","fixed"),l.style.setProperty("top","0px"),l.style.setProperty("left","0px"),l.style.setProperty("background","#fff"),pt(l,H(_.Component,ft({get stackTop(){return u.stackTop}},()=>u.params,()=>u.tempData))),lt(c=>{let $=u.path,U=u.className,T=x()<s.list.length-1?"none":"auto",N=x()*10,P=W()+"px",R=z()+"px";return $!==c._v$&&ct(l,"data-path",c._v$=$),U!==c._v$2&&it(l,c._v$2=U),T!==c._v$3&&l.style.setProperty("pointer-events",c._v$3=T),N!==c._v$4&&l.style.setProperty("z-index",c._v$4=N),P!==c._v$5&&l.style.setProperty("width",c._v$5=P),R!==c._v$6&&l.style.setProperty("height",c._v$6=R),c},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0,_v$6:void 0}),l})()}})};return{...n,goBack:O,search:e.search,nowUrl:e.nowUrl,nowFullUrl:e.nowFullUrl,searchUrlToObject:e.searchUrlToObject,listen:e.listen,beforeChange:e.beforeChange,getStack:()=>e.stack,Routers:j}};export{Ht as createRouter,at as useAnimationNavigation};
